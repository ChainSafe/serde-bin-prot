use serde_bin_prot::to_writer;
use std::f64::INFINITY;

fn get_test_cases() -> Vec<([u8; 8], f64)> {
    vec![
        (
            [0x3c, 0xb0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00],
            2.2204460492503131E-16,
        ),
        ([0x7f, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00], INFINITY),
        (
            [0x7f, 0xef, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff],
            1.7976931348623157E+308,
        ),
        ([0x7f, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00], INFINITY),
        (
            [0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00],
            2.2250738585072014E-308,
        ),
        (
            [0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01],
            4.94065645841247E-324,
        ),
        ([0xff, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00], -INFINITY),
        ([0xbf, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00], -1.0),
        ([0xff, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00], -INFINITY),
        ([0x3f, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00], 1.0),
        ([0x3e, 0x7a, 0xd7, 0xf2, 0x9a, 0xbc, 0xaf, 0x48], 1E-07),
        ([0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00], 0.0),
    ]
}

#[test]
fn test_serialize_floats() {
    for (bytes, val) in get_test_cases() {
        let mut output = Vec::<u8>::new();
        to_writer(&mut output, &val).unwrap();
        output.reverse();
        assert_eq!(output, bytes);
    }
}
